# Webページのテキスト入力をデータベースに保存する方法の調査

## 目的
Webページ上のテキストボックスに入力した文字列をデータベースに保存する具体的な実装手順と推奨構成をまとめる。

## 参照リポジトリ
- igakilab/springboot_samples: https://github.com/igakilab/springboot_samples
  - 本プロジェクトのSpring Bootの構成や実装方針を参考にする。
- Spring Boot ドキュメント（Data / Thymeleaf等）
- Thymeleaf フォームのドキュメント

## 前提
- 使用技術: Spring Boot（Spring MVC + Spring Data JPA）、Thymeleaf（テンプレート）、RDB（H2 / MySQLなど）
- プロジェクト構成は igakilab/springboot_samples を踏襲する。

## 発見事項（実装の流れ）
1. テーブル設計
   - 保存用テーブル例: messages
     - id: 主キー（自動採番）
     - content: 保存するテキスト（VARCHAR / TEXT）
     - created_at: 登録日時（TIMESTAMP）
   - マイグレーション管理: schema.sql を使う。

2. ドメイン（Entity）作成
   - Message エンティティを作成し、@Entity、@Id、@GeneratedValue 等を付与する。

3. リポジトリ作成
   - Spring Data JPA の JpaRepository<Message, Long> を作成し、保存（save）を利用する。



5. コントローラ
   - GET: テキスト入力フォームを返す（Thymeleaf）。
   - POST: フォーム送信を受け取り、バリデーション後にリポジトリ経由で保存する。
   - CSRF対策（Spring Securityを使用している場合はThymeleafの csrf トークンをフォームに含める）。

6. テンプレート（Thymeleaf）
   - form タグで入力欄（textarea / input）を作成し、送信先を POST に設定する。
   - バリデーションエラーの表示を実装する。

7. 設定
   - application.properties / application.yml にデータソース設定を追加（H2なら組み込み設定を推奨）。
   - JPA の設定（DDL自動生成の有無）を明記。

8. テストと確認方法
   - アプリ起動後、ブラウザでフォームにアクセスし、テキストを入力して送信 → DB にレコードが追加されることを確認。
   - H2 の場合はコンソール（/h2-console）で内容確認。

## 推奨ファイル配置（作成/編集するファイル）
- src/main/java/...(package)/model/Message.java  （Entity）
- src/main/java/...(package)/repository/MessageRepository.java （JpaRepository）
- src/main/java/...(package)/controller/MessageController.java
- src/main/resources/templates/messageForm.html （Thymeleaf フォーム）
- src/main/resources/application.properties

※ パスは igakilab/springboot_samples の慣例に合わせてください。

## セキュリティ・運用上の注意点
- 入力文字の長さや内容のバリデーションを実施する（XSS対策のため、テンプレート側で適切にエスケープする）。
- 認証が必要な機能なら適切な認可を配置する。
- データベース接続情報は環境変数やプロパティの分離で管理する。

## 推奨実装手順（高レベル）
1. ローカルで H2 を使って動作確認できるように application.properties を準備する。
2. Entity, Repository, Controller, Template を順に作成する（サービスは必要に応じて）。
3. 起動してフォームから保存を試し、H2コンソールで確認する。
4. 問題なければ MySQL 等への切り替えを行い、Flyway等でマイグレーションを管理する。

## 推奨テストケース（最小限）
- 正常系: フォームに有効なテキストを入力して保存、DB に1件追加される。
- 異常系: 長すぎる文字列、空文字、特殊文字、CSRF トークン無し等の処理を確認。

## 推奨事項（まとめ）
- igakilab/springboot_samples のプロジェクト構造と設定を参考に実装する。
- 開発段階は H2 で素早く動作確認し、その後本番用 DB に移行する。
- マイグレーションツール（Flyway等）を導入してスキーマ管理を行う。

## 参考URL
- igakilab/springboot_samples: https://github.com/igakilab/springboot_samples
- Spring Boot Docs: https://spring.io/projects/spring-boot
- Spring Data JPA: https://spring.io/projects/spring-data-jpa
- Thymeleaf: https://www.thymeleaf.org/


---
作業者: GitHub Copilot
作成日: 2025-11-25
